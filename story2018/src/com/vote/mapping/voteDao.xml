<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.vote.dao.VoteDao">
  <resultMap id="BaseResultMap" type="com.vote.model.VoteModel">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="vote_f"         jdbcType="INTEGER" javaType="int"    property="vote_f" />
    <result column="vote_t"         jdbcType="INTEGER" javaType="int"    property="vote_t" />
    <result column="name"           jdbcType="VARCHAR" javaType="String" property="name" />
    <result column="time"           jdbcType="VARCHAR" javaType="String" property="time" />
    <result column="ip"             jdbcType="VARCHAR" javaType="String" property="ip" />
    <!-- <result column="SUM(vote_f)"   jdbcType="INTEGER" javaType="int"    property="count" /> -->
    <result  column="percent"            javaType="String"     property="percent" />
     <result column="img"             jdbcType="VARCHAR" javaType="String" property="img" />
      <result column="subject"             jdbcType="VARCHAR" javaType="String" property="subject" />
       <result column="link"             jdbcType="VARCHAR" javaType="String" property="link" />
       <result column="ipArea"             jdbcType="VARCHAR" javaType="String" property="ipArea" />
  </resultMap>

  <sql id="Base_Column_List">
 concat(cast(coalesce(round(vote_f/(select SUM(vote_f) from story_vote),3),0)*100 as char),'%') as percent ,id, vote_f, vote_t,name ,img,subject,link
  </sql>
  
  <sql id="ip_Column_List">
    id, ip, time,ipArea
  </sql>
  <select id="listIpQuery" parameterType="com.vote.model.VoteModel" resultMap="BaseResultMap">
  select   <include refid="ip_Column_List" />  from story_log_ip
   where ip = #{ip,jdbcType=VARCHAR} AND time=#{time,jdbcType=VARCHAR}
  </select>
  <select id="listIpQuerycount" parameterType="com.vote.model.VoteModel" resultType="java.lang.Integer">
  select  count(ip)   from story_log_ip
   where ip = #{ip,jdbcType=VARCHAR} AND time=#{time,jdbcType=VARCHAR}
  </select>
   <select id="listIpcount"  resultType="java.lang.Integer">
 <!--  select  count(ip)   from story_log_ip -->
  SELECT  Count(ip)   FROM story_log_ip
  
  </select>
    <select id="listIp" resultType="com.vote.model.VoteModel">
  select  ip ,id  from story_log_ip   <!--  where id > 1 -->
  
   
  </select>
  
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from story_vote
    where id = #{id,jdbcType=INTEGER}
  </select>

  <select id="listquery"  resultMap="BaseResultMap">
  select  <include refid="Base_Column_List" />  from story_vote
  </select>
 
  <select id="citylike"  parameterType="java.lang.String" resultType="java.lang.Integer">
   select  count(ip)   from story_log_ip WHERE  
ipArea like CONCAT('%',#{ipArea},'%') 
  </select>
 
 
 
  <insert id="insertVote" parameterType="com.vote.model.VoteModel">
    insert into story_vote (id,vote_f,vote_t,name,img,subject,link)
    values (#{id,jdbcType=INTEGER}, #{vote_f,jdbcType=INTEGER}, #{vote_t,jdbcType=INTEGER}, #{Name,jdbcType=VARCHAR}, #{img,jdbcType=VARCHAR}, #{subject,jdbcType=VARCHAR} , #{link,jdbcType=VARCHAR})
  </insert>
  
  <insert id="insertIpSelective" parameterType="com.vote.model.VoteModel">
    insert into story_log_ip
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
       id,
      </if>
      <if test="ip != null">
       ip,
      </if>
      <if test="time != null">
        time,
      </if>
      <if test="ipArea != null">
        ipArea,
      </if>
      
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="ip != null">
        #{ip,jdbcType=VARCHAR},
      </if>
      <if test="time != null">
        #{time,jdbcType=VARCHAR},
      </if>
      <if test="ipArea != null">
        #{ipArea,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  
  
  
  <insert id="insertVoteSelective" parameterType="com.vote.model.VoteModel">
    insert into story_vote
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
       id,
      </if>
      <if test="name != null">
       name,
      </if>
      <if test="vote_f != null">
        vote_f,
      </if>
      <if test="vote_t != null">
        vote_t,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="vote_f != null">
        #{vote_f,jdbcType=INTEGER},
      </if>
      <if test="vote_t != null">
        #{vote_t,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateVoteSelective" parameterType="com.vote.model.VoteModel">
    update story_vote
    <set>
      <if test="name != null">
        name = #{uName,jdbcType=VARCHAR},
      </if>
      <if test="vote_f != null">
        vote_f = #{vote_f,jdbcType=INTEGER},
      </if>
    
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
 
 <update id="updateVoteADD1" parameterType="com.vote.model.VoteModel">
    update story_vote set vote_f=vote_f+1, vote_t=vote_t+1
   
    where id = #{id,jdbcType=INTEGER}
  </update>
 
 <update id="updateVoteipArea" parameterType="com.vote.model.VoteModel">
    update story_log_ip
    <set>
      
      <if test="ipArea != null">
       ipArea = #{ipArea,jdbcType=VARCHAR},
      </if>
    
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
</mapper>